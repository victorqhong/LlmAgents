{"contents":"using Microsoft.Extensions.Logging;\nusing Newtonsoft.Json.Linq;\nusing System;\nusing System.Threading.Tasks;\nusing LlmAgents.State;\nusing LlmAgents.Tools.BackgroundJob;\n\nnamespace LlmAgents.Tools.BackgroundJob;\n\npublic class JobStatusTool : Tool\n{\n    private readonly JobManager jobManager;\n\n    public JobStatusTool(ToolFactory toolFactory) : base(toolFactory)\n    {\n        jobManager = toolFactory.Resolve<JobManager>();\n        Schema = new JObject\n        {\n            [\"type\"] = \"function\",\n            [\"function\"] = new JObject\n            {\n                [\"name\"] = \"job_status\",\n                [\"description\"] = \"Get the current status of a background job.\",\n                [\"parameters\"] = new JObject\n                {\n                    [\"type\"] = \"object\",\n                    [\"properties\"] = new JObject\n                    {\n                        [\"job_id\"] = new JObject\n                        {\n                            [\"type\"] = \"string\",\n                            [\"description\"] = \"Identifier returned by start_job.\"\n                        }\n                    },\n                    [\"required\"] = new JArray { \"job_id\" }\n                }\n            }\n        };\n    }\n\n    public override JObject Schema { get; protected set; }\n\n    public override Task<JToken> Function(Session session, JObject parameters)\n    {\n        var jobIdStr = parameters[\"job_id\"]?.ToString();\n        if (!Guid.TryParse(jobIdStr, out var jobId))\n        {\n            return Task.FromResult<JToken>(new JObject { [\"error\"] = \"invalid job_id\" });\n        }\n        var info = jobManager.Get(jobId);\n        if (info == null)\n        {\n            return Task.FromResult<JToken>(new JObject { [\"error\"] = \"job not found\" });\n        }\n        var result = new JObject\n        {\n            [\"status\"] = info.Status.ToString().ToLowerInvariant(),\n            [\"started\"] = info.Started,\n            [\"ended\"] = info.Ended,\n            [\"exit_code\"] = info.ExitCode\n        };\n        return Task.FromResult<JToken>(result);\n    }\n}\n","path":"JobStatusTool.cs"}
